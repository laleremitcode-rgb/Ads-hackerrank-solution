#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <time.h>

typedef struct Node {
    int val;
    int priority;
    int size;
    struct Node *left, *right;
} Node;

Node* createNode(int val) {
    Node* newNode = (Node*)malloc(sizeof(Node));
    newNode->val = val;
    newNode->priority = rand();
    newNode->size = 1;
    newNode->left = newNode->right = NULL;
    return newNode;
}

int getSize(Node* node) {
    return node ? node->size : 0;
}

void updateSize(Node* node) {
    if (node) {
        node->size = 1 + getSize(node->left) + getSize(node->right);
    }
}

Node* merge(Node* left, Node* right) {
    if (!left) return right;
    if (!right) return left;
    
    if (left->priority > right->priority) {
        left->right = merge(left->right, right);
        updateSize(left);
        return left;
    } else {
        right->left = merge(left, right->left);
        updateSize(right);
        return right;
    }
}

void split(Node* root, int pos, Node** left, Node** right) {
    if (!root) {
        *left = *right = NULL;
        return;
    }
    
    int leftSize = getSize(root->left);
    if (pos <= leftSize) {
        split(root->left, pos, left, &root->left);
        *right = root;
    } else {
        split(root->right, pos - leftSize - 1, &root->right, right);
        *left = root;
    }
    updateSize(root);
}

Node* buildTree(int arr[], int l, int r) {
    if (l > r) return NULL;
    int mid = (l + r) / 2;
    Node* root = createNode(arr[mid]);
    root->left = buildTree(arr, l, mid - 1);
    root->right = buildTree(arr, mid + 1, r);
    updateSize(root);
    return root;
}

void inOrder(Node* root, int* arr, int* index) {
    if (!root) return;
    inOrder(root->left, arr, index);
    arr[(*index)++] = root->val;
    inOrder(root->right, arr, index);
}

int main() {
    srand(time(NULL));
    
    int n, q;
    scanf("%d %d", &n, &q);
    
    int* initial = (int*)malloc(n * sizeof(int));
    for (int i = 0; i < n; i++) {
        scanf("%d", &initial[i]);
    }
    
    Node* root = buildTree(initial, 0, n - 1);
    
    for (int i = 0; i < q; i++) {
        int type, l, r;
        scanf("%d %d %d", &type, &l, &r);
        l--; r--;
        
        Node *left, *mid, *right;
        
        // Split into three parts: [0, l-1], [l, r], [r+1, n-1]
        split(root, l, &left, &mid);
        split(mid, r - l + 1, &mid, &right);
        
        if (type == 1) {
            // Move to front: mid + left + right
            root = merge(mid, merge(left, right));
        } else {
            // Move to back: left + right + mid
            root = merge(merge(left, right), mid);
        }
    }
    
    // Convert tree back to array for output
    int* result = (int*)malloc(n * sizeof(int));
    int index = 0;
    inOrder(root, result, &index);
    
    printf("%d\n", abs(result[0] - result[n - 1]));
    for (int i = 0; i < n; i++) {
        printf("%d", result[i]);
        if (i < n - 1) printf(" ");
    }
    printf("\n");
    
    free(initial);
    free(result);
    return 0;
}
